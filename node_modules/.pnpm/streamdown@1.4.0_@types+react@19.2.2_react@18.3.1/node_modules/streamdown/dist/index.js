"use client";import{createContext as D,memo as We,useId as Ht,useMemo as Ue}from"react";import At from"react-markdown";import jt from"rehype-katex";import Rt from"rehype-raw";import Dt from"remark-gfm";import qt from"remark-math";import"katex/dist/katex.min.css";import{harden as Et}from"rehype-harden";import{isValidElement as S,memo as b,useContext as J}from"react";import{CheckIcon as Fe,CopyIcon as Ve,DownloadIcon as Ge}from"lucide-react";import{createContext as Ke,useContext as L,useEffect as Y,useRef as Z,useState as _}from"react";import{bundledLanguages as Qe,createHighlighter as K}from"shiki";import{createJavaScriptRegexEngine as Ye}from"shiki/engine/javascript";import{clsx as Xe}from"clsx";import{twMerge as Je}from"tailwind-merge";var m=(...e)=>Je(Xe(e)),P=(e,t,o)=>{let n=typeof t=="string"?new Blob([t],{type:o}):t,r=URL.createObjectURL(n),s=document.createElement("a");s.href=r,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)};import{jsx as v,jsxs as E}from"react/jsx-runtime";var Ze=/<pre(\s|>)/,W=Ke({code:""}),O=class{constructor(){this.lightHighlighter=null;this.darkHighlighter=null;this.lightTheme=null;this.darkTheme=null;this.loadedLanguages=new Set;this.initializationPromise=null}isLanguageSupported(t){return Object.hasOwn(Qe,t)}getFallbackLanguage(){return"text"}async ensureHighlightersInitialized(t,o){var c,p;let[n,r]=t,s=Ye({forgiving:!0}),i=!this.lightHighlighter||this.lightTheme!==n,d=!this.darkHighlighter||this.darkTheme!==r;(i||d)&&this.loadedLanguages.clear();let a=this.isLanguageSupported(o),l=!this.loadedLanguages.has(o)&&a;if(i?(this.lightHighlighter=await K({themes:[n],langs:a?[o]:[],engine:s}),this.lightTheme=n,a&&this.loadedLanguages.add(o)):l&&await((c=this.lightHighlighter)==null?void 0:c.loadLanguage(o)),d){let h=l?[...this.loadedLanguages].concat(a?[o]:[]):Array.from(this.loadedLanguages);this.darkHighlighter=await K({themes:[r],langs:h.length>0?h:a?[o]:[],engine:s}),this.darkTheme=r}else l&&await((p=this.darkHighlighter)==null?void 0:p.loadLanguage(o));l&&this.loadedLanguages.add(o)}async highlightCode(t,o,n,r){var p,h;this.initializationPromise&&await this.initializationPromise,this.initializationPromise=this.ensureHighlightersInitialized(n,o),await this.initializationPromise,this.initializationPromise=null;let[s,i]=n,d=this.isLanguageSupported(o)?o:this.getFallbackLanguage(),a=(p=this.lightHighlighter)==null?void 0:p.codeToHtml(t,{lang:d,theme:s}),l=(h=this.darkHighlighter)==null?void 0:h.codeToHtml(t,{lang:d,theme:i}),c=g=>r?g.replace(Ze,`<pre class="${r}"$1`):g;return[c(a),c(l)]}},et=new O,ee=({code:e,language:t,className:o,children:n,preClassName:r,...s})=>{let[i,d]=_(""),[a,l]=_(""),c=Z(!1),[p,h]=L(X);return Y(()=>(c.current=!0,et.highlightCode(e,t,[p,h],r).then(([g,f])=>{c.current&&(d(g),l(f))}),()=>{c.current=!1}),[e,t,p,h,r]),v(W.Provider,{value:{code:e},children:E("div",{className:"my-4 w-full overflow-hidden rounded-xl border","data-code-block-container":!0,"data-language":t,children:[E("div",{className:"flex items-center justify-between bg-muted/80 p-3 text-muted-foreground text-xs","data-code-block-header":!0,"data-language":t,children:[v("span",{className:"ml-1 font-mono lowercase",children:t}),v("div",{className:"flex items-center gap-2",children:n})]}),v("div",{className:"w-full",children:E("div",{className:"min-w-full",children:[v("div",{className:m("overflow-x-auto dark:hidden",o),dangerouslySetInnerHTML:{__html:i},"data-code-block":!0,"data-language":t,...s}),v("div",{className:m("hidden overflow-x-auto dark:block",o),dangerouslySetInnerHTML:{__html:a},"data-code-block":!0,"data-language":t,...s})]})})]})})},Q={"1c":"1c","1c-query":"1cq",abap:"abap","actionscript-3":"as",ada:"ada",adoc:"adoc","angular-html":"html","angular-ts":"ts",apache:"conf",apex:"cls",apl:"apl",applescript:"applescript",ara:"ara",asciidoc:"adoc",asm:"asm",astro:"astro",awk:"awk",ballerina:"bal",bash:"sh",bat:"bat",batch:"bat",be:"be",beancount:"beancount",berry:"berry",bibtex:"bib",bicep:"bicep",blade:"blade.php",bsl:"bsl",c:"c","c#":"cs","c++":"cpp",cadence:"cdc",cairo:"cairo",cdc:"cdc",clarity:"clar",clj:"clj",clojure:"clj","closure-templates":"soy",cmake:"cmake",cmd:"cmd",cobol:"cob",codeowners:"CODEOWNERS",codeql:"ql",coffee:"coffee",coffeescript:"coffee","common-lisp":"lisp",console:"sh",coq:"v",cpp:"cpp",cql:"cql",crystal:"cr",cs:"cs",csharp:"cs",css:"css",csv:"csv",cue:"cue",cypher:"cql",d:"d",dart:"dart",dax:"dax",desktop:"desktop",diff:"diff",docker:"dockerfile",dockerfile:"dockerfile",dotenv:"env","dream-maker":"dm",edge:"edge",elisp:"el",elixir:"ex",elm:"elm","emacs-lisp":"el",erb:"erb",erl:"erl",erlang:"erl",f:"f","f#":"fs",f03:"f03",f08:"f08",f18:"f18",f77:"f77",f90:"f90",f95:"f95",fennel:"fnl",fish:"fish",fluent:"ftl",for:"for","fortran-fixed-form":"f","fortran-free-form":"f90",fs:"fs",fsharp:"fs",fsl:"fsl",ftl:"ftl",gdresource:"tres",gdscript:"gd",gdshader:"gdshader",genie:"gs",gherkin:"feature","git-commit":"gitcommit","git-rebase":"gitrebase",gjs:"js",gleam:"gleam","glimmer-js":"js","glimmer-ts":"ts",glsl:"glsl",gnuplot:"plt",go:"go",gql:"gql",graphql:"graphql",groovy:"groovy",gts:"gts",hack:"hack",haml:"haml",handlebars:"hbs",haskell:"hs",haxe:"hx",hbs:"hbs",hcl:"hcl",hjson:"hjson",hlsl:"hlsl",hs:"hs",html:"html","html-derivative":"html",http:"http",hxml:"hxml",hy:"hy",imba:"imba",ini:"ini",jade:"jade",java:"java",javascript:"js",jinja:"jinja",jison:"jison",jl:"jl",js:"js",json:"json",json5:"json5",jsonc:"jsonc",jsonl:"jsonl",jsonnet:"jsonnet",jssm:"jssm",jsx:"jsx",julia:"jl",kotlin:"kt",kql:"kql",kt:"kt",kts:"kts",kusto:"kql",latex:"tex",lean:"lean",lean4:"lean",less:"less",liquid:"liquid",lisp:"lisp",lit:"lit",llvm:"ll",log:"log",logo:"logo",lua:"lua",luau:"luau",make:"mak",makefile:"mak",markdown:"md",marko:"marko",matlab:"m",md:"md",mdc:"mdc",mdx:"mdx",mediawiki:"wiki",mermaid:"mmd",mips:"s",mipsasm:"s",mmd:"mmd",mojo:"mojo",move:"move",nar:"nar",narrat:"narrat",nextflow:"nf",nf:"nf",nginx:"conf",nim:"nim",nix:"nix",nu:"nu",nushell:"nu",objc:"m","objective-c":"m","objective-cpp":"mm",ocaml:"ml",pascal:"pas",perl:"pl",perl6:"p6",php:"php",plsql:"pls",po:"po",polar:"polar",postcss:"pcss",pot:"pot",potx:"potx",powerquery:"pq",powershell:"ps1",prisma:"prisma",prolog:"pl",properties:"properties",proto:"proto",protobuf:"proto",ps:"ps",ps1:"ps1",pug:"pug",puppet:"pp",purescript:"purs",py:"py",python:"py",ql:"ql",qml:"qml",qmldir:"qmldir",qss:"qss",r:"r",racket:"rkt",raku:"raku",razor:"cshtml",rb:"rb",reg:"reg",regex:"regex",regexp:"regexp",rel:"rel",riscv:"s",rs:"rs",rst:"rst",ruby:"rb",rust:"rs",sas:"sas",sass:"sass",scala:"scala",scheme:"scm",scss:"scss",sdbl:"sdbl",sh:"sh",shader:"shader",shaderlab:"shader",shell:"sh",shellscript:"sh",shellsession:"sh",smalltalk:"st",solidity:"sol",soy:"soy",sparql:"rq",spl:"spl",splunk:"spl",sql:"sql","ssh-config":"config",stata:"do",styl:"styl",stylus:"styl",svelte:"svelte",swift:"swift","system-verilog":"sv",systemd:"service",talon:"talon",talonscript:"talon",tasl:"tasl",tcl:"tcl",templ:"templ",terraform:"tf",tex:"tex",tf:"tf",tfvars:"tfvars",toml:"toml",ts:"ts","ts-tags":"ts",tsp:"tsp",tsv:"tsv",tsx:"tsx",turtle:"ttl",twig:"twig",typ:"typ",typescript:"ts",typespec:"tsp",typst:"typ",v:"v",vala:"vala",vb:"vb",verilog:"v",vhdl:"vhdl",vim:"vim",viml:"vim",vimscript:"vim",vue:"vue","vue-html":"html","vue-vine":"vine",vy:"vy",vyper:"vy",wasm:"wasm",wenyan:"wy",wgsl:"wgsl",wiki:"wiki",wikitext:"wiki",wit:"wit",wl:"wl",wolfram:"wl",xml:"xml",xsl:"xsl",yaml:"yaml",yml:"yml",zenscript:"zs",zig:"zig",zsh:"zsh",\u6587\u8A00:"wy"},U=({onDownload:e,onError:t,language:o,children:n,className:r,code:s,...i})=>{let{code:d}=L(W),{isAnimating:a}=L(M),l=s!=null?s:d,p=`file.${o&&o in Q?Q[o]:"txt"}`,h="text/plain",g=()=>{try{P(p,l,h),e==null||e()}catch(f){t==null||t(f)}};return v("button",{className:m("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",r),disabled:a,onClick:g,title:"Download file",type:"button",...i,children:n!=null?n:v(Ge,{size:14})})},z=({onCopy:e,onError:t,timeout:o=2e3,children:n,className:r,code:s,...i})=>{let[d,a]=_(!1),l=Z(0),{code:c}=L(W),{isAnimating:p}=L(M),h=s!=null?s:c,g=async()=>{var w;if(typeof window=="undefined"||!((w=navigator==null?void 0:navigator.clipboard)!=null&&w.writeText)){t==null||t(new Error("Clipboard API not available"));return}try{d||(await navigator.clipboard.writeText(h),a(!0),e==null||e(),l.current=window.setTimeout(()=>a(!1),o))}catch(y){t==null||t(y)}};Y(()=>()=>{window.clearTimeout(l.current)},[]);let f=d?Fe:Ve;return v("button",{className:m("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",r),disabled:p,onClick:g,type:"button",...i,children:n!=null?n:v(f,{size:14})})};import{DownloadIcon as tt}from"lucide-react";import{jsx as $,jsxs as ot}from"react/jsx-runtime";var te=({node:e,className:t,src:o,alt:n,...r})=>{let s=async()=>{var i;if(o)try{let a=await(await fetch(o)).blob(),c=new URL(o,window.location.origin).pathname.split("/").pop()||"",p=c.includes(".")&&((i=c.split(".").pop())==null?void 0:i.length)<=4,h="";if(p)h=c;else{let g=a.type,f="png";g.includes("jpeg")||g.includes("jpg")?f="jpg":g.includes("png")?f="png":g.includes("svg")?f="svg":g.includes("gif")?f="gif":g.includes("webp")&&(f="webp"),h=`${(n||c||"image").replace(/\.[^/.]+$/,"")}.${f}`}P(h,a,a.type)}catch(d){console.error("Failed to download image:",d)}};return o?ot("div",{className:"group relative my-4 inline-block","data-streamdown":"image-wrapper",children:[$("img",{alt:n,className:m("max-w-full rounded-lg",t),"data-streamdown":"image",src:o,...r}),$("div",{className:"pointer-events-none absolute inset-0 hidden rounded-lg bg-black/10 group-hover:block"}),$("button",{className:m("absolute right-2 bottom-2 flex h-8 w-8 cursor-pointer items-center justify-center rounded-md border border-border bg-background/90 shadow-sm backdrop-blur-sm transition-all duration-200 hover:bg-background","opacity-0 group-hover:opacity-100"),onClick:s,title:"Download image",type:"button",children:$(tt,{size:14})})]}):null};import{useEffect as nt,useState as x}from"react";import{jsx as N,jsxs as H}from"react/jsx-runtime";var st=async e=>{let o={...{startOnLoad:!1,theme:"default",securityLevel:"strict",fontFamily:"monospace",suppressErrorRendering:!0},...e},r=(await import("mermaid")).default;return r.initialize(o),r},oe=({chart:e,className:t,config:o})=>{let[n,r]=x(null),[s,i]=x(!0),[d,a]=x(""),[l,c]=x("");if(nt(()=>{(async()=>{try{r(null),i(!0);let g=await st(o),f=e.split("").reduce((C,q)=>(C<<5)-C+q.charCodeAt(0)|0,0),w=`mermaid-${Math.abs(f)}-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,{svg:y}=await g.render(w,e);a(y),c(y)}catch(g){if(!(l||d)){let f=g instanceof Error?g.message:"Failed to render Mermaid chart";r(f)}}finally{i(!1)}})()},[e,o]),s&&!d&&!l)return N("div",{className:m("my-4 flex justify-center p-4",t),children:H("div",{className:"flex items-center space-x-2 text-muted-foreground",children:[N("div",{className:"h-4 w-4 animate-spin rounded-full border-current border-b-2"}),N("span",{className:"text-sm",children:"Loading diagram..."})]})});if(n&&!d&&!l)return H("div",{className:m("rounded-lg border border-red-200 bg-red-50 p-4",t),children:[H("p",{className:"font-mono text-red-700 text-sm",children:["Mermaid Error: ",n]}),H("details",{className:"mt-2",children:[N("summary",{className:"cursor-pointer text-red-600 text-xs",children:"Show Code"}),N("pre",{className:"mt-2 overflow-x-auto rounded bg-red-100 p-2 text-red-800 text-xs",children:e})]})]});let p=d||l;return N("div",{"aria-label":"Mermaid chart",className:m("my-4 flex justify-center",t),dangerouslySetInnerHTML:{__html:p},role:"img"})};import{CheckIcon as rt,CopyIcon as at,DownloadIcon as it}from"lucide-react";import{useContext as se,useEffect as re,useRef as ae,useState as ie}from"react";import{jsx as I,jsxs as ne}from"react/jsx-runtime";function le(e){var s,i;let t=[],o=[],n=e.querySelectorAll("thead th");for(let d of n)t.push(((s=d.textContent)==null?void 0:s.trim())||"");let r=e.querySelectorAll("tbody tr");for(let d of r){let a=[],l=d.querySelectorAll("td");for(let c of l)a.push(((i=c.textContent)==null?void 0:i.trim())||"");o.push(a)}return{headers:t,rows:o}}function de(e){let{headers:t,rows:o}=e,n=s=>s.includes(",")||s.includes('"')||s.includes(`
`)?`"${s.replace(/"/g,'""')}"`:s,r=[];t.length>0&&r.push(t.map(n).join(","));for(let s of o)r.push(s.map(n).join(","));return r.join(`
`)}function ce(e){let{headers:t,rows:o}=e;if(t.length===0)return"";let n=[],r=t.map(s=>s.replace(/\|/g,"\\|"));n.push(`| ${r.join(" | ")} |`),n.push(`| ${t.map(()=>"---").join(" | ")} |`);for(let s of o){let i=[...s];for(;i.length<t.length;)i.push("");let d=i.map(a=>a.replace(/\|/g,"\\|"));n.push(`| ${d.join(" | ")} |`)}return n.join(`
`)}var me=({children:e,className:t,onCopy:o,onError:n,timeout:r=2e3,format:s="markdown"})=>{let[i,d]=ie(!1),a=ae(0),{isAnimating:l}=se(M),c=async h=>{var g;if(typeof window=="undefined"||!((g=navigator==null?void 0:navigator.clipboard)!=null&&g.write)){n==null||n(new Error("Clipboard API not available"));return}try{if(!i){let w=h.currentTarget.closest('[data-streamdown="table-wrapper"]'),y=w==null?void 0:w.querySelector("table");if(!y){n==null||n(new Error("Table not found"));return}let C=le(y),q=new ClipboardItem({"text/plain":s==="markdown"?ce(C):de(C),"text/html":new Blob([y.outerHTML],{type:"text/html"})});await navigator.clipboard.write([q]),d(!0),o==null||o(),a.current=window.setTimeout(()=>d(!1),r)}}catch(f){n==null||n(f)}};re(()=>()=>{window.clearTimeout(a.current)},[]);let p=i?rt:at;return I("button",{className:m("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",t),disabled:l,onClick:c,title:`Copy table as ${s}`,type:"button",children:e!=null?e:I(p,{size:14})})};var pe=({children:e,className:t,onDownload:o,onError:n})=>{let[r,s]=ie(!1),i=ae(null),{isAnimating:d}=se(M),a=l=>{var c;try{let p=(c=i.current)==null?void 0:c.closest('[data-streamdown="table-wrapper"]'),h=p==null?void 0:p.querySelector("table");if(!h){n==null||n(new Error("Table not found"));return}let g=le(h),f=l==="csv"?de(g):ce(g);P(`table.${l==="csv"?"csv":"md"}`,f,l==="csv"?"text/csv":"text/markdown"),s(!1),o==null||o(l)}catch(p){n==null||n(p)}};return re(()=>{let l=c=>{i.current&&!i.current.contains(c.target)&&s(!1)};return document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[]),ne("div",{className:"relative",ref:i,children:[I("button",{className:m("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",t),disabled:d,onClick:()=>s(!r),title:"Download table",type:"button",children:e!=null?e:I(it,{size:14})}),r&&ne("div",{className:"absolute top-full right-0 z-10 mt-1 min-w-[120px] rounded-md border border-border bg-background shadow-lg",children:[I("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>a("csv"),type:"button",children:"CSV"}),I("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>a("markdown"),type:"button",children:"Markdown"})]})]})};import{Fragment as qe,jsx as u,jsxs as B}from"react/jsx-runtime";var lt=/language-([^\s]+)/;function A(e,t){if(!(e!=null&&e.position||t!=null&&t.position))return!0;if(!(e!=null&&e.position&&(t!=null&&t.position)))return!1;let o=e.position.start,n=t.position.start,r=e.position.end,s=t.position.end;return(o==null?void 0:o.line)===(n==null?void 0:n.line)&&(o==null?void 0:o.column)===(n==null?void 0:n.column)&&(r==null?void 0:r.line)===(s==null?void 0:s.line)&&(r==null?void 0:r.column)===(s==null?void 0:s.column)}function k(e,t){return e.className===t.className&&A(e.node,t.node)}var F=(e,t)=>typeof e=="boolean"?e:e[t]!==!1,V=b(({children:e,className:t,node:o,...n})=>u("ol",{className:m("ml-4 list-outside list-decimal whitespace-normal",t),"data-streamdown":"ordered-list",...n,children:e}),(e,t)=>k(e,t));V.displayName="MarkdownOl";var ue=b(({children:e,className:t,node:o,...n})=>u("li",{className:m("py-1",t),"data-streamdown":"list-item",...n,children:e}),(e,t)=>e.className===t.className&&A(e.node,t.node));ue.displayName="MarkdownLi";var ge=b(({children:e,className:t,node:o,...n})=>u("ul",{className:m("ml-4 list-outside list-disc whitespace-normal",t),"data-streamdown":"unordered-list",...n,children:e}),(e,t)=>k(e,t));ge.displayName="MarkdownUl";var fe=b(({className:e,node:t,...o})=>u("hr",{className:m("my-6 border-border",e),"data-streamdown":"horizontal-rule",...o}),(e,t)=>k(e,t));fe.displayName="MarkdownHr";var he=b(({children:e,className:t,node:o,...n})=>u("span",{className:m("font-semibold",t),"data-streamdown":"strong",...n,children:e}),(e,t)=>k(e,t));he.displayName="MarkdownStrong";var be=b(({children:e,className:t,href:o,node:n,...r})=>{let s=o==="streamdown:incomplete-link";return u("a",{className:m("wrap-anywhere font-medium text-primary underline",t),"data-incomplete":s,"data-streamdown":"link",href:o,rel:"noreferrer",target:"_blank",...r,children:e})},(e,t)=>k(e,t)&&e.href===t.href);be.displayName="MarkdownA";var ke=b(({children:e,className:t,node:o,...n})=>u("h1",{className:m("mt-6 mb-2 font-semibold text-3xl",t),"data-streamdown":"heading-1",...n,children:e}),(e,t)=>k(e,t));ke.displayName="MarkdownH1";var ye=b(({children:e,className:t,node:o,...n})=>u("h2",{className:m("mt-6 mb-2 font-semibold text-2xl",t),"data-streamdown":"heading-2",...n,children:e}),(e,t)=>k(e,t));ye.displayName="MarkdownH2";var we=b(({children:e,className:t,node:o,...n})=>u("h3",{className:m("mt-6 mb-2 font-semibold text-xl",t),"data-streamdown":"heading-3",...n,children:e}),(e,t)=>k(e,t));we.displayName="MarkdownH3";var ve=b(({children:e,className:t,node:o,...n})=>u("h4",{className:m("mt-6 mb-2 font-semibold text-lg",t),"data-streamdown":"heading-4",...n,children:e}),(e,t)=>k(e,t));ve.displayName="MarkdownH4";var Me=b(({children:e,className:t,node:o,...n})=>u("h5",{className:m("mt-6 mb-2 font-semibold text-base",t),"data-streamdown":"heading-5",...n,children:e}),(e,t)=>k(e,t));Me.displayName="MarkdownH5";var Te=b(({children:e,className:t,node:o,...n})=>u("h6",{className:m("mt-6 mb-2 font-semibold text-sm",t),"data-streamdown":"heading-6",...n,children:e}),(e,t)=>k(e,t));Te.displayName="MarkdownH6";var Ce=b(({children:e,className:t,node:o,...n})=>{let r=J(j),s=F(r,"table");return B("div",{className:"my-4 flex flex-col space-y-2","data-streamdown":"table-wrapper",children:[s&&B("div",{className:"flex items-center justify-end gap-1",children:[u(me,{}),u(pe,{})]}),u("div",{className:"overflow-x-auto",children:u("table",{className:m("w-full border-collapse border border-border",t),"data-streamdown":"table",...n,children:e})})]})},(e,t)=>k(e,t));Ce.displayName="MarkdownTable";var Pe=b(({children:e,className:t,node:o,...n})=>u("thead",{className:m("bg-muted/80",t),"data-streamdown":"table-header",...n,children:e}),(e,t)=>k(e,t));Pe.displayName="MarkdownThead";var Ne=b(({children:e,className:t,node:o,...n})=>u("tbody",{className:m("divide-y divide-border bg-muted/40",t),"data-streamdown":"table-body",...n,children:e}),(e,t)=>k(e,t));Ne.displayName="MarkdownTbody";var Ie=b(({children:e,className:t,node:o,...n})=>u("tr",{className:m("border-border border-b",t),"data-streamdown":"table-row",...n,children:e}),(e,t)=>k(e,t));Ie.displayName="MarkdownTr";var Se=b(({children:e,className:t,node:o,...n})=>u("th",{className:m("whitespace-nowrap px-4 py-2 text-left font-semibold text-sm",t),"data-streamdown":"table-header-cell",...n,children:e}),(e,t)=>k(e,t));Se.displayName="MarkdownTh";var Le=b(({children:e,className:t,node:o,...n})=>u("td",{className:m("px-4 py-2 text-sm",t),"data-streamdown":"table-cell",...n,children:e}),(e,t)=>k(e,t));Le.displayName="MarkdownTd";var Be=b(({children:e,className:t,node:o,...n})=>u("blockquote",{className:m("my-4 border-muted-foreground/30 border-l-4 pl-4 text-muted-foreground italic",t),"data-streamdown":"blockquote",...n,children:e}),(e,t)=>k(e,t));Be.displayName="MarkdownBlockquote";var $e=b(({children:e,className:t,node:o,...n})=>u("sup",{className:m("text-sm",t),"data-streamdown":"superscript",...n,children:e}),(e,t)=>k(e,t));$e.displayName="MarkdownSup";var xe=b(({children:e,className:t,node:o,...n})=>u("sub",{className:m("text-sm",t),"data-streamdown":"subscript",...n,children:e}),(e,t)=>k(e,t));xe.displayName="MarkdownSub";var He=b(({children:e,className:t,node:o,...n})=>{if("data-footnotes"in n){let s=a=>{var h,g;if(!S(a))return!1;let l=Array.isArray(a.props.children)?a.props.children:[a.props.children],c=!1,p=!1;for(let f of l)if(f){if(typeof f=="string")f.trim()!==""&&(c=!0);else if(S(f))if(((h=f.props)==null?void 0:h["data-footnote-backref"])!==void 0)p=!0;else{let w=Array.isArray(f.props.children)?f.props.children:[f.props.children];for(let y of w){if(typeof y=="string"&&y.trim()!==""){c=!0;break}if(S(y)&&((g=y.props)==null?void 0:g["data-footnote-backref"])===void 0){c=!0;break}}}}return p&&!c},i=Array.isArray(e)?e.map(a=>{if(!S(a))return a;if(a.type===V){let c=(Array.isArray(a.props.children)?a.props.children:[a.props.children]).filter(p=>!s(p));return c.length===0?null:{...a,props:{...a.props,children:c}}}return a}):e;return(Array.isArray(i)?i.some(a=>a!==null):i!==null)?u("section",{className:t,...n,children:i}):null}return u("section",{className:t,...n,children:e})},(e,t)=>k(e,t));He.displayName="MarkdownSection";var dt=({node:e,className:t,children:o,...n})=>{var p,h,g;let r=((p=e==null?void 0:e.position)==null?void 0:p.start.line)===((h=e==null?void 0:e.position)==null?void 0:h.end.line),s=J(G),i=J(j);if(r)return u("code",{className:m("rounded bg-muted px-1.5 py-0.5 font-mono text-sm",t),"data-streamdown":"inline-code",...n,children:o});let d=t==null?void 0:t.match(lt),a=(g=d==null?void 0:d.at(1))!=null?g:"",l="";if(S(o)&&o.props&&typeof o.props=="object"&&"children"in o.props&&typeof o.props.children=="string"?l=o.props.children:typeof o=="string"&&(l=o),a==="mermaid"){let f=F(i,"mermaid");return B("div",{className:m("group relative my-4 h-auto rounded-xl border p-4",t),"data-streamdown":"mermaid-block",children:[f&&B("div",{className:"flex items-center justify-end gap-2",children:[u(U,{code:l,language:a}),u(z,{code:l})]}),u(oe,{chart:l,config:s})]})}let c=F(i,"code");return u(ee,{className:m("overflow-x-auto border-t",t),code:l,"data-language":a,"data-streamdown":"code-block",language:a,preClassName:"overflow-x-auto font-mono text-xs p-4 bg-muted/40",children:c&&B(qe,{children:[u(U,{code:l,language:a}),u(z,{})]})})},Ae=b(dt,(e,t)=>e.className===t.className&&A(e.node,t.node));Ae.displayName="MarkdownCode";var je=b(te,(e,t)=>e.className===t.className&&A(e.node,t.node));je.displayName="MarkdownImg";var Re=b(({children:e,className:t,node:o,...n})=>{var i;let s=(Array.isArray(e)?e:[e]).filter(d=>d!=null&&d!=="");return s.length===1&&S(s[0])&&((i=s[0].props.node)==null?void 0:i.tagName)==="img"?u(qe,{children:e}):u("p",{className:t,...n,children:e})},(e,t)=>k(e,t));Re.displayName="MarkdownParagraph";var De={ol:V,li:ue,ul:ge,hr:fe,strong:he,a:be,h1:ke,h2:ye,h3:we,h4:ve,h5:Me,h6:Te,table:Ce,thead:Pe,tbody:Ne,tr:Ie,th:Se,td:Le,blockquote:Be,code:Ae,img:je,pre:({children:e})=>e,sup:$e,sub:xe,p:Re,section:He};import{Lexer as ct}from"marked";var Ee=e=>{let t=/\[\^[^\]\s]{1,200}\](?!:)/.test(e),o=/\[\^[^\]\s]{1,200}\]:/.test(e);if(t||o)return[e];let n=ct.lex(e,{gfm:!0}),r=[],s=[];for(let i=0;i<n.length;i++){let d=n[i],a=d.raw;if(s.length>0){if(r[r.length-1]+=a,d.type==="html"){let l=a.match(/<\/(\w+)>/);if(l){let c=l[1];s[s.length-1]===c&&s.pop()}}continue}if(d.type==="html"&&d.block){let l=a.match(/<(\w+)[\s>]/);if(l){let c=l[1];a.includes(`</${c}>`)||s.push(c)}}if(a.trim()==="$$"&&r.length>0){let l=r.at(-1);if(!l){r.push(a);continue}let c=l.trimStart().startsWith("$$"),p=(l.match(/\$\$/g)||[]).length;if(c&&p%2===1){r[r.length-1]=l+a;continue}}if(r.length>0&&a.trimEnd().endsWith("$$")){let l=r.at(-1);if(!l){r.push(a);continue}let c=l.trimStart().startsWith("$$"),p=(l.match(/\$\$/g)||[]).length,h=(a.match(/\$\$/g)||[]).length;if(c&&p%2===1&&!a.trimStart().startsWith("$$")&&h===1){r[r.length-1]=l+a;continue}}r.push(a)}return r};var mt=/(!?\[)([^\]]*?)$/,pt=/(\*\*)([^*]*?)$/,ut=/(__)([^_]*?)$/,gt=/(\*\*\*)([^*]*?)$/,ft=/(\*)([^*]*?)$/,ht=/(_)([^_]*?)$/,bt=/(`)([^`]*?)$/,kt=/(~~)([^~]*?)$/,R=e=>{let t=(e.match(/```/g)||[]).length;return t>0&&t%2===0&&e.includes(`
`)},yt=e=>{let t=/(!?)\[([^\]]+)\]\(([^)]+)$/,o=e.match(t);if(o){let r=o[1]==="!",s=o[2],i=o[3],d=e.lastIndexOf(`${r?"!":""}[${s}](${i}`),a=e.substring(0,d);return r?a:`${a}[${s}](streamdown:incomplete-link)`}let n=e.match(mt);if(n){if(n[1].startsWith("!")){let s=e.lastIndexOf(n[1]);return e.substring(0,s)}return`${e}](streamdown:incomplete-link)`}return e},wt=e=>{if(R(e))return e;let t=e.match(pt);if(t){let o=t[2];if(!o||/^[\s_~*`]*$/.test(o))return e;let n=e.lastIndexOf(t[1]),s=e.substring(0,n).lastIndexOf(`
`),i=s===-1?0:s+1,d=e.substring(i,n);if(/^[\s]*[-*+][\s]+$/.test(d)&&o.includes(`
`))return e;if((e.match(/\*\*/g)||[]).length%2===1)return`${e}**`}return e},vt=e=>{let t=e.match(ut);if(t){let o=t[2];if(!o||/^[\s_~*`]*$/.test(o))return e;let n=e.lastIndexOf(t[1]),s=e.substring(0,n).lastIndexOf(`
`),i=s===-1?0:s+1,d=e.substring(i,n);if(/^[\s]*[-*+][\s]+$/.test(d)&&o.includes(`
`))return e;if((e.match(/__/g)||[]).length%2===1)return`${e}__`}return e},Mt=e=>e.split("").reduce((t,o,n)=>{if(o==="*"){let r=e[n-1],s=e[n+1];if(r==="\\")return t;let i=n;for(let a=n-1;a>=0;a--){if(e[a]===`
`){i=a+1;break}if(a===0){i=0;break}}if(e.substring(i,n).trim()===""&&(s===" "||s==="	"))return t;if(r!=="*"&&s!=="*")return t+1}return t},0),Tt=e=>{if(R(e))return e;if(e.match(ft)){let o=-1;for(let s=0;s<e.length;s++)if(e[s]==="*"&&e[s-1]!=="*"&&e[s+1]!=="*"){o=s;break}if(o===-1)return e;let n=e.substring(o+1);if(!n||/^[\s_~*`]*$/.test(n))return e;if(Mt(e)%2===1)return`${e}*`}return e},_e=(e,t)=>{let o=!1,n=!1;for(let r=0;r<e.length&&r<t;r++){if(e[r]==="\\"&&e[r+1]==="$"){r++;continue}e[r]==="$"&&(e[r+1]==="$"?(n=!n,r++,o=!1):n||(o=!o))}return o||n},Ct=e=>e.split("").reduce((t,o,n)=>{if(o==="_"){let r=e[n-1],s=e[n+1];if(r==="\\"||_e(e,n)||r&&s&&/[\p{L}\p{N}_]/u.test(r)&&/[\p{L}\p{N}_]/u.test(s))return t;if(r!=="_"&&s!=="_")return t+1}return t},0),Pt=e=>{if(R(e))return e;if(e.match(ht)){let o=-1;for(let s=0;s<e.length;s++)if(e[s]==="_"&&e[s-1]!=="_"&&e[s+1]!=="_"&&e[s-1]!=="\\"&&!_e(e,s)){let i=s>0?e[s-1]:"",d=s<e.length-1?e[s+1]:"";if(i&&d&&/[\p{L}\p{N}_]/u.test(i)&&/[\p{L}\p{N}_]/u.test(d))continue;o=s;break}if(o===-1)return e;let n=e.substring(o+1);if(!n||/^[\s_~*`]*$/.test(n))return e;if(Ct(e)%2===1){let s=e.match(/\n+$/);return s?`${e.slice(0,-s[0].length)}_${s[0]}`:`${e}_`}}return e},Nt=(e,t)=>{let o=e.substring(t,t+3)==="```",n=t>0&&e.substring(t-1,t+2)==="```",r=t>1&&e.substring(t-2,t+1)==="```";return o||n||r},It=e=>{let t=0;for(let o=0;o<e.length;o++)e[o]==="`"&&!Nt(e,o)&&t++;return t},St=e=>{if(e.match(/^```[^`\n]*```?$/)&&!e.includes(`
`))return e.endsWith("``")&&!e.endsWith("```")?`${e}\``:e;let o=(e.match(/```/g)||[]).length,n=o%2===1;if(o>0&&o%2===0&&e.includes(`
`)||(e.endsWith("```\n")||e.endsWith("```"))&&o%2===0)return e;let r=e.match(bt);if(r&&!n){let s=r[2];if(!s||/^[\s_~*`]*$/.test(s))return e;if(It(e)%2===1)return`${e}\``}return e},Lt=e=>{let t=e.match(kt);if(t){let o=t[2];if(!o||/^[\s_~*`]*$/.test(o))return e;if((e.match(/~~/g)||[]).length%2===1)return`${e}~~`}return e};var Bt=e=>{if((e.match(/\$\$/g)||[]).length%2===0)return e;let o=e.indexOf("$$");return o!==-1&&e.indexOf(`
`,o)!==-1&&!e.endsWith(`
`)?`${e}
$$`:`${e}$$`},$t=e=>{let t=0,o=e.match(/\*+/g)||[];for(let n of o){let r=n.length;r>=3&&(t+=Math.floor(r/3))}return t},xt=e=>{if(R(e)||/^\*{4,}$/.test(e))return e;let t=e.match(gt);if(t){let o=t[2];if(!o||/^[\s_~*`]*$/.test(o))return e;if($t(e)%2===1)return`${e}***`}return e},Oe=e=>{if(!e||typeof e!="string")return e;let t=e,o=yt(t);return o.endsWith("](streamdown:incomplete-link)")?o:(t=o,t=xt(t),t=wt(t),t=vt(t),t=Tt(t),t=Pt(t),t=St(t),t=Lt(t),t=Bt(t),t)};import{jsx as T}from"react/jsx-runtime";var _t={harden:[Et,{allowedImagePrefixes:["*"],allowedLinkPrefixes:["*"],defaultOrigin:void 0,allowDataImages:!0}],raw:Rt,katex:[jt,{errorColor:"var(--color-muted-foreground)"}]},Ot={gfm:[Dt,{}],math:[qt,{singleDollarTextMath:!1}]},X=D(["github-light","github-dark"]),G=D(void 0),j=D(!0),M=D({isAnimating:!1}),ze=We(({content:e,shouldParseIncompleteMarkdown:t,...o})=>{let n=Ue(()=>typeof e=="string"&&t?Oe(e.trim()):e,[e,t]);return T(At,{...o,children:n})},(e,t)=>e.content===t.content);ze.displayName="Block";var Wt=We(({children:e,parseIncompleteMarkdown:t=!0,components:o,rehypePlugins:n=Object.values(_t),remarkPlugins:r=Object.values(Ot),className:s,shikiTheme:i=["github-light","github-dark"],mermaidConfig:d,controls:a=!0,isAnimating:l=!1,...c})=>{let p=Ht(),h=Ue(()=>Ee(typeof e=="string"?e:""),[e]);return T(X.Provider,{value:i,children:T(G.Provider,{value:d,children:T(j.Provider,{value:a,children:T(M.Provider,{value:{isAnimating:l},children:T("div",{className:m("space-y-4",s),children:h.map((g,f)=>T(ze,{components:{...De,...o},content:g,rehypePlugins:n,remarkPlugins:r,shouldParseIncompleteMarkdown:t,...c},`${p}-block-${f}`))})})})})})},(e,t)=>e.children===t.children&&e.shikiTheme===t.shikiTheme&&e.isAnimating===t.isAnimating);Wt.displayName="Streamdown";export{j as ControlsContext,G as MermaidConfigContext,X as ShikiThemeContext,Wt as Streamdown,M as StreamdownRuntimeContext,_t as defaultRehypePlugins,Ot as defaultRemarkPlugins};
